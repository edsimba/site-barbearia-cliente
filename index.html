<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbearia Score - Oficial</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; padding: 20px; }
        .box { background: #1e1e1e; padding: 20px; border-radius: 10px; max-width: 350px; margin: auto; border: 1px solid #333; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 5px; border: none; }
        button { background: #e67e22; color: white; font-weight: bold; cursor: pointer; }
        .hidden { display: none !important; }
        #status { color: #ff5555; font-size: 12px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="box">
    <div id="area-login">
        <h2>Acessar</h2>
        <input type="email" id="email" placeholder="E-mail">
        <input type="password" id="senha" placeholder="Senha">
        <button onclick="entrar()">Entrar</button>
        <button onclick="cadastrar()" style="background: #333;">Criar Conta</button>
        <div id="status"></div>
    </div>

    <div id="area-cliente" class="hidden">
        <div style="background: #1b5e20; padding: 15px; border-radius: 8px;">
            <p>Saldo Score</p>
            <h1 id="saldo">R$ 0,00</h1>
        </div>
        <p>Atendimento aos Domingos</p>
        <button onclick="location.reload()" style="background:#444">Sair</button>
    </div>
</div>

<script>
    const URL = "https://vbckjvgefobuwwswlrdk.supabase.co";
    const KEY = "sb_publishable_j8gX5czIDTtA3Ex3-zDPsw_n5RUbZoD";
    const supabaseClient = supabase.createClient(URL, KEY);

    async function entrar() {
        const email = document.getElementById('email').value;
        const senha = document.getElementById('senha').value;
        const status = document.getElementById('status');

        status.innerText = "Conectando...";
        
        const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password: senha });

        if (error) {
            status.innerText = "Erro: " + error.message;
        } else {
            document.getElementById('area-login').style.display = 'none';
            document.getElementById('area-cliente').classList.remove('hidden');
            carregarDados(data.user.id);
        }
    }

    async function cadastrar() {
        const email = document.getElementById('email').value;
        const senha = document.getElementById('senha').value;
        
        const { data, error } = await supabaseClient.auth.signUp({ email, password: senha });

        if (error) {
            alert("Erro no cadastro: " + error.message);
        } else {
            // Cria o registro de saldo para o novo usu√°rio
            await supabaseClient.from('perfis').insert([{ id: data.user.id, saldo_score: 0 }]);
            alert("Conta criada! Clique em Entrar agora.");
        }
    }

    async function carregarDados(userId) {
        const { data } = await supabaseClient.from('perfis').select('saldo_score').eq('id', userId).single();
        if (data) document.getElementById('saldo').innerText = `R$ ${data.saldo_score.toFixed(2)}`;
    }
</script>
</body>
</html>
